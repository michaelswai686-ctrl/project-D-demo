<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Supabase Messages Demo</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 600px; margin: 20px auto; }
  ul { list-style: none; padding: 0; }
  li { margin-bottom: 10px; padding: 10px; background: #f4f4f4; border-radius: 5px; }
  form { margin-top: 20px; }
  input[type="text"] { padding: 10px; width: 80%; }
  button { padding: 10px; }
</style>
</head>
<body>

<h1>Messages</h1>
<ul id="messages"></ul>

<form id="form">
  <input type="text" id="content" placeholder="Write a message..." autocomplete="off" />
  <button type="submit">Send</button>
</form>

<script>
  async function fetchMessages() {
    const res = await fetch('/api/messages');
    const data = await res.json();
    const ul = document.getElementById('messages');
    ul.innerHTML = '';
    data.forEach(msg => {
      const li = document.createElement('li');
      li.textContent = msg.content + ' (' + new Date(msg.created_at).toLocaleString() + ')';
      ul.appendChild(li);
    });
  }

  async function sendMessage(content) {
    await fetch('/api/messages', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ content })
    });
  }

  document.getElementById('form').addEventListener('submit', async (e) => {
    e.preventDefault();
    const input = document.getElementById('content');
    const content = input.value.trim();
    if (!content) return alert('Please enter a message');
    await sendMessage(content);
    input.value = '';
    fetchMessages();
  });

  fetchMessages();
  // Optional: refresh messages every 10 seconds
  setInterval(fetchMessages, 10000);
</script>

</body>
</html>
